generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  GUEST
  HOST
  ADMIN
}

model User {
  id          String  @id @default(uuid())
  name        String
  email       String  @unique
  phoneNumber String? @unique

  gender        String?
  role          Role           @default(GUEST)
  isVerified    Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  auth          Auth?
  // Relations
  properties    Property[]
  bookings      Booking[]
  payments      Payment[]
  transactions  Transaction[]
  uploads       Upload[]
  AuthOtpTokens AuthOtpToken[]
}

enum PropertyType {
  APARTMENT
  HOTEL
}

model Auth {
  id       String @id @default(uuid())
  password String
  user     User   @relation(fields: [userId], references: [id])
  userId   String @unique
}

enum AuthOtpTokenType {
  TOKEN
  OTP
}

model AuthOtpToken {
  id      String           @id @default(uuid())
  subject String
  type    AuthOtpTokenType @default(OTP)
  code    String           @unique

  expiry DateTime
  email  String
  user   User?    @relation(fields: [userId], references: [id])
  userId String?

  @@index([code])
  @@index([email])
}

model Property {
  id          String       @id @default(uuid())
  name        String
  description String
  address     String
  email      String
  phoneNumber  String
  location     String
 
  type        PropertyType @default(APARTMENT)
  features    String[]
  amenities   String[]
  // images      String[]

  // Apartment-specific fields
  price      Float?
  capacity   Int?
  isVerified Boolean @default(false)

  host   User   @relation(fields: [hostId], references: [id])
  hostId String

  rooms        Room[]
  bookings     Booking[]
  // uploads     Upload[]
  attachments  Attachments? @relation(fields: [attachmentId], references: [id])
 
  rule     Upload? @relation("PropertyRule", fields: [ruleId], references: [id])
  ruleId   String? @unique
  attachmentId String?
  fullText     String       @default("")
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
}

enum RoomCategory {
  SINGLE
  STANDARD
  DELUXE
  SUITE
}

model Room {
  id          String       @id @default(uuid())
  title       String
  description String
  price       Float
  capacity    Int
  category    RoomCategory @default(SINGLE)
  amenities   String[]
  isAvailable Boolean      @default(true)

  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String

  bookings     Booking[]
  payments     Payment[]
  transactions Transaction[]
  attachments  Attachments   @relation(fields: [attachmentId], references: [id])
  attachmentId String        @unique
  fullText     String        @default("")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

model Booking {
  id         String        @id @default(uuid())
  checkIn    DateTime
  checkOut   DateTime
  totalPrice Float
  status     BookingStatus @default(PENDING)

  guest   User   @relation(fields: [guestId], references: [id])
  guestId String

  property   Property? @relation(fields: [propertyId], references: [id])
  propertyId String?

  room     Room?   @relation(fields: [roomId], references: [id])
  roomId   String?
  fullText String  @default("")

  expiresAt  DateTime

  payment      Payment[]
  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Attachments {
  id         String     @id @default(uuid())
  uploads    Upload[]
  properties Property[]
  rooms      Room[]
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CARD
  WALLET
  BANK_TRANSFER
 
}

model Payment {
  id            String        @id @default(uuid())
  amount        Float
  currency      String        @default("USD")
  status        PaymentStatus @default(PENDING)
  method        PaymentMethod?
  transactionId String?

  guest   User   @relation(fields: [guestId], references: [id])
  guestId String

  booking   Booking @relation(fields: [bookingId], references: [id])
  bookingId String

  room   Room   @relation(fields: [roomId], references: [id])
  roomId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
  CANCELLED
}

model Transaction {
  id        String            @id @default(uuid())
  amount     Int
  currency  String            @default("USD")
  status    TransactionStatus @default(PENDING)
  // method    PaymentMethod?
  reference String?
  response  String?
  redirectUrl String?
  flwRef  String?

  user   User   @relation(fields: [userId], references: [id])
  userId String

  booking   Booking? @relation(fields: [bookingId], references: [id])
  bookingId String?

  room   Room?   @relation(fields: [roomId], references: [id])
  roomId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Upload {
  id   String @id @default(uuid())
  name String
  url  String
  publicId String
  type String
   size Int
   order Int

  user         User?        @relation(fields: [userId], references: [id])
  userId       String?
 
   attachments Attachments? @relation(fields: [attachmentsId], references: [id])
  attachmentsId String?
   propertyRule Property? @relation("PropertyRule")

  
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
}
